# 上下文切换

---

## 简介

`Context Switch(CS)`上下文切换是cpu性能中的一个重要指标. CS过高会导致CPU像个搬运工, 频繁的在寄存器和运行队列之间奔波, 更多的时间花在线程切换, 而不是真正工作的线程上. 直接的消耗包括CPU寄存器需要保存和加载, 系统调度器的代码需要执行. 间接消耗在于多核cache之间的共享数据.

## 切换原因

* 当前任务的时间片用完之后, 系统CPU正常调度下一个任务.
* 当前任务碰到IO阻塞, 调度线程将挂起此任务, 继续下一个任务.
* 多个任务抢占锁资源, 当前任务没有抢到, 被调度器挂起, 继续下一个任务.
* 用户代码挂起当前任务, 让出CPU时间.
* 硬件中断.

## 工具

* `vmstat`监控系统上下文切换.
* `pidstat`监控指定进程的上下文切换.

