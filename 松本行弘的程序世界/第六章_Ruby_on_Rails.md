# 第六章 Ruby on Rails

### MVC 和 Ruby on Rails

#### 模型,视图和控制的作用

* 模型: 代表的只是信息(名字,数值等抽象的信息).代表==应用逻辑==.
* 视图: 代表将模型中包含的信息在窗口进行表示的对象.提供界面的视图.
* 控制: 是从用户端接受输入,对视图和模型进行操作的对象.

相对应用逻辑变更来说,界面变更的情况占绝大多数,所以把他们分离开是很合理的.

#### MVC 的优缺点

**优点**

* 可以更换界面
* 一个模型对应多个视图
* 多个视图可以同时相应
* 容易测试

**缺点**

* 复杂性
* 强关联性. 模型,视图和控制三者相互之间保持了强关联性.对模型对象进行了功能追加这样的变更之后,相应地也必须对视图和控制进行变更.

#### Web 应用中的MVC

1. Web 浏览器发送来的HTTP请求通过Web服务器传给控制部分. Web应用框架的分配器(分配部件)把请求传递给合适的控制部分.
2. 控制部分操作的模型和请求的信息相对应,同时指定显示使用的视图.视图从模型启动,一边引用模型一边准备发送诶Web浏览器的数据.
3. Web 服务器吧数据以HTTO相应的形式送还 Web 浏览器.

**传统的MVC 和 Rails MVC的比较**

Rails中的模型相当于数据库层,视图指显示用的模板,控制器指控制用的类(包含了应用逻辑).

传统的MVC	  | Rails的MVC
------------- | -------------
模型			  | 模型+控制器 (个人感觉业务逻辑会渗透到控制器中)
视图			  | 视图
控制器		  | 分配器+控制器

**我个人理解**

类似`Rails`,现在大部分框架所谓3层是指:

* 用户界面(UI)层
* 业务逻辑层
* 数据库层

传统的 MVC 模型把 业务层和数据库层 合为一体称为模型.

### 开放类和猴子补丁

#### 开放类

```ruby
class Foo < Bar
	def plus2(arg1, arg2)
		return arg1 + arg2
	end
end

class Foo 
	def times2(arg1, arg2)
		return arg1 * arg2
	end
end
```
又累上面的代码, `Foo` 类就可以使用从 `Bar` 类继承来的方法,以及前面定义的方法 `plus2` 和新定义的方法 `times2`.这样对 `Foo` 类重新定义之后,即使是已经生成的 `Foo` 类对象,也拥有新增加的功能.

#### 猴子补丁的目的

使用开放类,不改变原先的代码,替换方法(相当于打补丁)被称为猴子补丁.使用此技术可以完成以下功能:

* 功能追加
* 功能变更
* 修改程序错误

		因为重新定义了有程序错误或有副作用的方法,不用修改原来那部分的代码就可以解决问题.
* 钩子

		想在每个方法调用的同事增加一些其他处理,比如日志输出功能.这种伴随方法调用而进行的处理称为"钩子'(hook).
* 缓存

		在计算量很大,而且一次计算之后结果可以反复使用的情况下,在一次计算完成后,对方法进行替换可以提高处理的速度
		
#### 猴子补丁的技巧


