# 第六章 Ruby on Rails

### MVC 和 Ruby on Rails

#### 模型,视图和控制的作用

* 模型: 代表的只是信息(名字,数值等抽象的信息).代表==应用逻辑==.
* 视图: 代表将模型中包含的信息在窗口进行表示的对象.提供界面的视图.
* 控制: 是从用户端接受输入,对视图和模型进行操作的对象.

相对应用逻辑变更来说,界面变更的情况占绝大多数,所以把他们分离开是很合理的.

#### MVC 的优缺点

**优点**

* 可以更换界面
* 一个模型对应多个视图
* 多个视图可以同时相应
* 容易测试

**缺点**

* 复杂性
* 强关联性. 模型,视图和控制三者相互之间保持了强关联性.对模型对象进行了功能追加这样的变更之后,相应地也必须对视图和控制进行变更.

#### Web 应用中的MVC

1. Web 浏览器发送来的HTTP请求通过Web服务器传给控制部分. Web应用框架的分配器(分配部件)把请求传递给合适的控制部分.
2. 控制部分操作的模型和请求的信息相对应,同时指定显示使用的视图.视图从模型启动,一边引用模型一边准备发送诶Web浏览器的数据.
3. Web 服务器吧数据以HTTO相应的形式送还 Web 浏览器.

**传统的MVC 和 Rails MVC的比较**

Rails中的模型相当于数据库层,视图指显示用的模板,控制器指控制用的类(包含了应用逻辑).

传统的MVC	  | Rails的MVC
------------- | -------------
模型			  | 模型+控制器 (个人感觉业务逻辑会渗透到控制器中)
视图			  | 视图
控制器		  | 分配器+控制器

**我个人理解**

类似`Rails`,现在大部分框架所谓3层是指:

* 用户界面(UI)层
* 业务逻辑层
* 数据库层

传统的 MVC 模型把 业务层和数据库层 合为一体称为模型.

### 开放类和猴子补丁

#### 开放类

```ruby
class Foo < Bar
	def plus2(arg1, arg2)
		return arg1 + arg2
	end
end

class Foo 
	def times2(arg1, arg2)
		return arg1 * arg2
	end
end
```
又累上面的代码, `Foo` 类就可以使用从 `Bar` 类继承来的方法,以及前面定义的方法 `plus2` 和新定义的方法 `times2`.这样对 `Foo` 类重新定义之后,即使是已经生成的 `Foo` 类对象,也拥有新增加的功能.

#### 猴子补丁的目的

使用开放类,不改变原先的代码,替换方法(相当于打补丁)被称为猴子补丁.使用此技术可以完成以下功能:

* 功能追加
* 功能变更
* 修改程序错误

		因为重新定义了有程序错误或有副作用的方法,不用修改原来那部分的代码就可以解决问题.
* 钩子

		想在每个方法调用的同事增加一些其他处理,比如日志输出功能.这种伴随方法调用而进行的处理称为"钩子'(hook).
* 缓存

		在计算量很大,而且一次计算之后结果可以反复使用的情况下,在一次计算完成后,对方法进行替换可以提高处理的速度
		
#### 猴子补丁的技巧

* alias: 给方法另起别名
* include: 加入其它模块中的方法
* remove_method: 取消本类中的方法
* undef: 取消方法

**undef**

* 取消本类中的方法. 
* 取消父类中定义的方法.

**alias**

给方法起了一个别名,起了别名的方法和以前的方法只是名字不同,功能完全一样.

一般做法是,给某个方法用`alias`起个别名,在重新定义的方法中用别名来调用原来的方法,从而给原来的方法增加新功能.

**include**

是类或者模块中把其它模块的方法包含进来的功能.

#### 灵活使用开放类的库

#### 猴子补丁的几点问题

开放类和猴子补丁让我们很方地做各种操作,但是它们也有缺点.猴子补丁动态地对类进行变更,从而对程序整体产生了影响.

##### 基本上只是追加功能

对类追加新方法不会让已有的程序无法执行.

##### 进行功能变更时要慎重,尽可能小规模

增加可选参数,或是只在特定的情况下进行变更,在一定程度上保持兼容性的变更会更保险.

**小心相互作用**

开放类,和继承,导入等其他处理方式相比==独立性较低==.

#### 其他办法

##### 面向方面

面向方面的目的是==要分离出横向关联的共通侧面==.

面向对象语言把程序分割成对象单位,世上并不是所有的共通侧面都能分割成对象单位.

==横向关联设计多个对象的处理,共通侧面虽然只有一个,却断断续续地分散到多个类中==.

		记录日志,要记录值得类有多个,那么在这个或哪个类里面都要有记录日志的处理.本来是想在一个地方集中处理所关系的事情,但因为程序构成已经被分割成类的形式,横跨了多个类的这个方面无法总结在一起.
		
像这样横跨了多个类的共通关注的事就是==方面(aspect)==.按照关心的事来划分,记述并组合而成的程序称为==面向方面==编程.		
		
**个人理解**

`AOP(Aspect Oriented Programming`,面向切面编程.

#### Ruby on Rails 和开放类




