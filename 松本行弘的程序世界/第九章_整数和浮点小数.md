# 第九章 整数和浮点小数

### 深奥的整数世界

`Ruby`中,整数相除得到整数.这里和`php`不同.

`php`计算规则如下:

* 除法运算符总是返回浮点数.只有在下列情况例外:两个操作数都是整数(或字符串转换成的整数)并且正好能整除,这时它返回一个整数.

* 取模运算符的操作数在运算之前都会转换成整数(除去小数部分).

#### 整数是有范围的

`C` 语言中有多重表示整数的数据类型.每种数据类型能够表示的整数位数值一定的.位数是指二进制数据的位数.正如刚才所说的,二进制中的1位称作1比特,也可以说==每种数据类型占据的比特数是不一样的==.

`C`语言中如果运算结果超出了规定的位数,不会报错,溢出的位数仅仅被忽视了.

#### 尝试位运算

* `|` 按位或
* `&` 按位与
* `^` 按位异或
* `~` 按位取反
* `<<` 左移
* `>>` 右移

```php

205: 11001001
5: 	      101

201 | 5 = 205
201 $ 5 = 1
201 ^ 5 = 204
```

根据二进制性质:

* ==左移==一位相当于将数变成==2倍==.
* ==右移==一位相当于将数编程==一半==.

```php
php -r "echo 4>>1,PHP_EOL;"
2
```

#### 操作特定的位

计算机中处理各种数据都是以二进制的位来表示的.

* 文本是由字符所对应编码的数字串来组成,各数字串最后还是还原成二进制的比特.
* 图像数据是各个点的颜色按一定形式排列,最后也还是二进制的比特串.
* 程序本身就是二进制的比特穿.

==操作二进制位就等于操作计算机的数据==

**基本 位 处理**

* 取出特定位的状态
* 特定位置位(设为1)
* 特定位清零(设为0)
* 特定位反转

**使用场景**

要从一连串二进制位取出某一特定为`a`的状态.这个功能用按位`与(&)`来实现.准备一个数`B`,只需将想取出那一位置设为1,其余位置设为0,那么取`A`与`B`的按位与,就可以只取出`A`数中的`a`位的状态.

```php
	 ? ? ? ? a ? ? ?    比特串A
	 0 0 0 0 1 0 0 0	比特串B(掩码)
	 0 0 0 0 a 0 0 0 	计算机结果
```

仅生成某一特定位为1的数,可以用移位运算符.使用`1<<n`就可以得到近某一特定位为1的数.

`1<<n` 最低位为0,像左偏移`n`位相当于乘以`2*n`,可以得到最高位为`1`其余位为`0`.

```php
1<<3 = 8 = 1000
1<<2 = 4 = 0100
1<<1 = 2 = 0010
1<<0 = 1 = 0001
```

第`n`位是从最后一位开始数.最低位为0.

**取出整数A第3位的状态**

```php
A & (1<<3)

13: 1101
6:  0110
13 & 6 = 0100 = 4
php -r "echo 14 & 6;"
```

**将变量A的第3位设为1**

用按位或写成以下形式:

```php
A | (1<<3)

13 :    1101 
1<<1:   0010
echo 13 | (1<<1); => 15
```

按与位,可以不管原数内容,而将其某一位设为`1`.

**位清零**

将某一特定位设为0.

要将第2位清零:

```php

A & ~(1<<2)


1<<2 = 0100
~(1<<2) = 1011
A & 1011  = 第2位清零
```

**位反转**

`1`变`0`, `0`变`1`.

$a ^ $b 	`Xor`（按位异或） 	将把 $a 和 $b 中一个为 1 另一个为 0 的位设为 1。

```php
A ^ (1<<3)

A ^ 1000

第3位取反
```

**标志位操作**

用位操作,可以将多个标志位(指定 ON 或者 OFF 的选项)用一个参数来传递.

#### 表示负数的办法

表示负数的方法:

* 开头一位用作符号位
* 将整数的各位反转(1的补数)

```php
8位整数:

第一种方法: 10000001
第二种方法: 11111110
```

负数一般用2的补数来表示.2的补数是将正数的每一位反转,然后加1所得的数.

```php
-1的2的补数:

00000001 (数1)
11111110 (位反转)
11111111 (加1)
```

**2的补数表示负数的优点**

* 可以表示 256 个数. 采用符号位方式或1的补数方式, 0 和 -0 都存在,只能表示255个数.
* 可以直接运算. 2的补数的方式,不考虑符号,直接进行四则运算就可以得到正确结果.

#### Ruby的整数

#### 挑战公开密钥的方式

**最大公约数**

？