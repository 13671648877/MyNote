# 第八章 正则表达式

### 正则表达式基础

#### 正则表达式的语法

正则表达式由称为元(`meta`)字符的特殊功能字符和其他字符组成.元字符有点像编程语言中的控制结构.

**元字符和其含义**

* `.` 与任意单个字符相匹配
* `[]` [a-z]与a到z之间任何一个相匹配
* `[^]` [^a-z]与a到z==以外==的字符相匹配
* `\w` 构成单词的字符
* `\W` 构成单词的字符以外
* `\s` 空白文字. 与[\t\n\r\f]相同
* `\S` 非空白文字
* `\d` 数字. 与[0-9]相同
* `\D` 非数字. 与[^0-9]相同
* `*` 重复0次以上
* `+` 重复1次以上
* `?` 重复0次或1次
* `{m,n}` 重复m次到n次
* `*?` 重复0次以上(懒惰匹配)
* `+?` 重复1次以上(懒惰匹配)
* `??` 重复0次或1次(懒惰匹配)
* `{m,n}?` 重复m次到n次(懒惰匹配)
* `^` 行首匹配
* `$` 行尾匹配
* `\A` 字符串头
* `\Z` 字符串尾(若含换行,匹配前一字符)
* `\z` 字符串尾
* `\b` backspace(0x08)([]内)
* `\b` 词头或词尾 ([]外)
* `\B` 非词头亦非词尾
* `|` 选择
* `()` 分组(有向后引用)
* `\1,\2` 向后引用(对应第n个括号)
* `(?:)` 分组(无向后引用)
* `(? =)` 用哪个模式指定位置(无宽度)
* `(?!)` 用否定模式指定位置(无宽度)
* `(? #)` 注释

**懒惰和贪婪匹配**

正则表达式中,有从最左边开始选择最长匹配的最左最长原则.

`greedy`贪婪模式: 一定要找到与模式相一致的最长字符串.视图找到像匹配的最长字符串.

		http://www.ruby-lang.org:80/ja/
		
		开头的 http: 用 .*: 去匹配,结果匹配到了 http://www.ruby-lang.org
		
继续检索冒号,一直到字符串的最后,发现没有了在折回.这种折回称为回溯(`backtrack`).

如果后面一个重复系列的元字符`?`,就不在贪婪,而是进行懒惰(non-greddy)匹配.懒惰匹配时,第一次与模式匹配时就停止检索.

		.*:? 可以得到 http:
     	
**普通字符**

元字符以外的就是普通字符.都与该字符自身相匹配.

**字符集合**

用括号(`[]`)括起来的部分为字符集合.与括号内所含的每一个字符都匹配.

`-` 指定范围. [abcdef] 可以用 [a-f] 代替

`^` 表示取反,不与括号([])中的字符相匹配.

**任意一个字符**

`.` 表示任意一个字符.`.' 不能匹配换行符.

		p..l 以 p 开始,任意2个字符之后跟l的模式.
		
**重复**

* `a*` 
	* 下限 0
	* 上限 无
* `a+` 
	* 下限 1
	* 上限 无
* `a?` 
	* 下限 0
	* 上限 1
* `a{n,m}` 
	* 下限 n
	* 上限 m
* `a{n}` 
	* 下限 n
	* 上限 n
* `a{n,}` 
	* 下限 n
	* 上限 无

**分组**

重复是以近前的正则表达式为对象, `ma+` 是指 `m` 与跟随其后的 `1` 个以上的 `a`. 如果想要表达 `ma` 重复1次以上,就要用括号括起来, 变成`(ma)+`.

**选择**

从多个模式中选出一种的元字符是`|`. 比如 `yes|no`.

`ye(s|n)o` 配合分组,这个表达式的意思是: `ye` 后跟着 `s` 或者 `n`, 然后跟着 `o`.

**锚点**

* `^` : 行首
* `$` : 行尾
* `\A`: 字符串头
* `\Z`: 字符串尾(若含换行,匹配前一字符)
* `\z`: 字符串尾
* `\b`: 词头或词尾([]外)
* `(? =)`: 用模式指定位置
* `(?!)` 用否定模式指定位置(无宽度)
 