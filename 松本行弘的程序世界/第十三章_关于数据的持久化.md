# 第十三章 关于数据的持久化

### 关于持久化数据的方法

#### 保存文本

#### 变换成文本的 Marshal

UNINX 系列操作系统中,文件可以看做是文本数据的容器.

将对象按一定的方式变换为文本,就可以保存到文件中去.这样的对象文本化,就称为:

* serialize(序列化)
* marshal(封送处理)

#### 复制有两种方法

**浅复制**

`shallow cop`,只复制直接对象,引用的对象不复制.

`deep copy`深复制. 联通引用对象一起进行==递归复制==.

#### 变换为文本的 YAML

YAML 是 YAML Ain't Markup Language (YAML 不是标记语言) 的缩略语.

* 放弃标记性技术
* 专注于数据表现
* 以缩进为基础表现数据结构
* 不要标签
* 可以对应各种语言

### 对象的保存

#### 高速的 Object Prevalence

**日志记录**

文杰写入外部的存储器时,在记录实际数据之前,先写入管理信息(元数据),以及元数据的变更记录.

#### Object Prevalence的问题点

Object Prevalence 通过使用日志记录和快照实现了对象的持久化和进程共享.

**缺点**

将所有的数据都保存到内存中,随着数据量的增大,内存的消耗也在增大.

关系数据库中,不应用的数据放在文件中,必要的内存量就不用那么多了.

### 关于 XML 的考察

#### XML 的祖先是 SGML

SGML (Standard Generalized Markup Language), 由3部分组成:

* 数据本身的 Instance
* 数据结构格式的 DTD (Document Type Definition)
* SGML 声明

HTML 是 SGML 适用于特定的DTD产物,是 SGML 的实例 后者说是 子集.

#### 优点在于纯文本

以文本形式可以不用考虑读取的软件,即使在老也可以方便读取.这个是 XML 一个很大的优越性.

* 数据全部以纯文本表示,表示结构的信息附加在标签里.
* 不易发生关于字符编码的问题. XML 规定,在没有明确指定的情况下, 字符编码均使用 Unicode.
* 在没有数据结构的情况下也能解析 XML 数据.
* XML 与其解析工具不依赖于特定的语言.

#### 缺点在于冗长


#### XML 的代替

* JSON
* YAML
* Binary XML 二进制XML
* Protocol Buffer (协议缓冲),内部使用的进程间通信技术,用二进制表现它,时间和空间效率都有提高.
* Thtift 包括序列化,还包括远程过程调用.


