# DNS A CNAME MX PTR 等记录有什么区别

---

### 区域文件

区域文件是名称服务器存储其所知道的域名的信息的方式.名称服务器知道的每个域名都存储在区域文件中.对于名称服务器来说,大多数请求都不能在它自己服务器中找到区域文件.

如果它被配置成可以递归查询,如解析名称服务器,那它会递归找到结果并返回.否则,它会告诉请求者方下一步到哪里查询.

名称服务器具有的区域文件越多,它能够权威回答的请求越多.

区域文件描述 DNS "区域",其基本上是整个 DNS 命名系统的子集.它通常只配置一个域名.它可以包含多个记录,定义了该域名下的资源位置.

区域文件的 `$ORIGIN` 表示该区域最高等级的权威.

所以如果一个区域文件被配置为 "example.com" 域,`$ORIGIN` 会被设置为 http://example.com.

它配置在区域文件的顶部,或者可以在引用区域文件的 DNS 服务器的配置文件中定义.无论哪种方式,此参数描述区域将是什么等级的权威.

类似地,$TTL 配置它提供的信息的 "生存时间". 它基本上是一个计时器. 高速缓存名称服务器可以使用先前查询的结果来回答问题,直到 `TTL` 值用完.

### SOA记录

开始授权, 或者说是 SOA, 这种记录是所有区域性文件中的强制性记录. 必须是一个文件中的第一个记录(`$ORIGIN` 和 `$TTL` 会在它之前指定).

开始权限记录的看起来像这样:

		domain.com.  IN SOA ns1.domain.com. admin.domain.com. (
                                            12083   ; serial number
                                            3h      ; refresh interval
                                            30m     ; retry interval
                                            3w      ; expiry period
                                            1h      ; negative TTL
		)
		
* `domain.com.`: 这是区域的根.这表明该区域文件用于 `domain.com` 域名.通常, 你会看到这个用`@`代理,它只是一个占位符,表示我们之前学到的`$ORIGIN`变量的内容.
* `IN SOA`: "`IN`"部分表示物联网. `SOA`表示这是开始权限记录.
* `ns1.domain.com.`: 这定义了该域的主名称服务器.名称服务器可以是主服务器或从服务器,如果配置了动态DNS,就像这里,则一个服务器需要是"主服务器".如果你未配置动态DNS,那么这只是你其中一个主名称服务器.
* `admin.domain.com.`: 这是这个区域文件管理员的邮箱地址. 邮箱地址的 `@` 这里用一个 `.` 代替.如果你的名字中也有 `.` 它会用 `\` 代替.(比如 your.name@domain.com 变成 your\name.domain.com).
* `12083`: 这是区域文件的序列号.每次编辑区域文件时,必须增加此序列号以使区域文件能够正确传播.从服务器将检查主服务器的区域序列号是否大于它们在系统上的序列号.如果是,它请求新的区域文件,如果不是,它继续服务原始文件.
* `3h`: 这是区域的刷新间隔.这是从服务器向主服务器轮询检查区域文件是否变更之间等待的时间量.
* `30m`: 这是此区域的重试间隔.如果从机在刷新周期结束时无法连接到主机,则它将等待此时间并重试轮询主机.
* `3w`: 这是到期时间.如果从服务器在此时间内无法与主服务器联系,则它不再作为此区域的权威来源的返回响应.
* `1h`: 这是名称服务器在此文件中找不到所请求的名称时缓存找不到结果的时间量.

### A 和 AAAA 记录

这两个记录都将主机映射到 IP 地址. "A" 记录用于将主机映射到 IPv4 IP 地址, 而 "AAAA" 记录用于将主机映射到 IPv6 地址.

这些记录的一般格式是:

		host     IN      A       IPv4_address
		host     IN      AAAA    IPv6_address
		
因为我们的 SOA 记录指出了我们的主服务器是 "ns1.domain.com"，而 "ns1.domain.com" 也是 "domain.com" 区域文件定义的,所以我们需要把它指向一个 IP 地址.

这条记录可能看起来像这样:

		ns1     IN  A       111.222.111.222
		
请注意,我们不必提供全名.我们可以只给主机名,不需要 FQDN,然后 DNS 服务器会通过 `$ORIGIN` 补足其余部分.但是, 我们也可以使用完整的 `FQDN`:

		ns1.domain.com.     IN  A       111.222.111.222
		
大多数情况下,在这里你可以将你的 web 服务器定义为 "www":

		www     IN  A       222.222.222.222

我们还可以说明基本域解析到哪里.如下表示:

		domain.com.     IN  A       222.222.222.222
		
我们还可以使用 "@" 来表示基本域名:

		@       IN  A       222.222.222.222
		
我们还可以解析此域下未明确定义的任何内容到此服务器.可以使用 "*" 通配符:

		*       IN  A       222.222.222.222
		
以上这些对于 AAAA 记录同样适用.

### CNAME 记录

CNAME 记录为您的服务器(由A或AAAA记录定义的名称)定义规范名称的别名:

例如,我们可以有一个 A 记录定义 "server1" 主机,然后使用 "www" 作为此主机的别名:

		server1     IN  A       111.111.11
		
		1.111
		www         IN  CNAME   server1
		
请注意,这些别名会带来一些性能损失,因为它们需要对服务器进行额外的查询.大多数时候,通过使用附加的 A 或 AAAA 记录可以实现相同的结果.

推荐使用 CNAME 的一种情况是为当前区域之外的资源提供别名.

### MX 记录

MX 记录用来定义用于域的邮件交换.这有助于电子邮件正确到达您的邮件服务器.

与许多其他记录类型不同的是,邮件记录通常不会将主机映射到某些内容,因为它们适用于整个区域.

		IN  MX  10   mail.domain.com.
		
开头没有主机名.

还要注意,它还有一个额外的数字.如果定义了多个邮件服务器,这是帮助计算机决定发送邮件的服务器的首选项号.较低的数字具有较高的优先级.

`MX` 记录通常应指向由 `A` 或 `AAAA` 记录定义的主机,而不是由 `CNAME` 定义的主机.

所以,假设我们有两个邮件服务器.可以这样表示:

		        IN  MX  10  mail1.domain.com.
        		IN  MX  50  mail2.domain.com.
		mail1   IN  A       111.111.111.111
		mail2   IN  A       222.222.222.222

在这个例子中,"mail1" 主机是首选电子邮件交换服务器.

我们也可以这样写:

		        IN  MX  10  mail1
		        IN  MX  50  mail2
		mail1   IN  A       111.111.111.111
		mail2   IN  A       222.222.222.222
		
### NS 记录

此记录类型定义用于此区域的名称服务器.

"如果区域文件放在名称服务器上,为什么它需要引用自身?".DNS 如此成功的其中一个原因是它的多级缓存.在区域文件中定义名称服务器的一个原因是区域文件可能是另外一个名称服务器的缓存副本.在区域文件中定义名称服务器的一个原因是区域文件可能是另外一个名称服务器的缓存副本.

与 MX 记录一样,它也有一些区域范围的参数,因此它们也不使用主机.

        IN  NS     ns1.domain.com.
        IN  NS     ns2.domain.com.
        
你应该在每个区域文件中至少定义两个名称服务器,以便在一个服务器出现问题时还能正确运行.如果只有一个名称服务器,大多数 DNS 服务器软件都会认为区域文件无效.

同样,把主机的 A 或者 AAAA 映射也包含记录中:

		        IN  NS     ns1.domain.com.
		        IN  NS     ns2.domain.com.
		ns1     IN  A      111.222.111.111
		ns2     IN  A      123.211.111.233		
        
### PTR 记录

PTR 记录用于定义与 IP 地址相关联的名称.PTR 记录是 A 或 AAAA 记录的`逆`.PTR 记录是唯一的,因为它们以 `.arpa` 根开始并被委派给 IP 地址的所有者.区域互联网注册管理机构(RIRs)管理 IP 地址到组织和服务提供商的指派.
区域互联网注册管理机构包括 APNIC,ARIN,RIPE NCC,LACNIC 和 AFRINIC.

这里是一个 111.222.333.444 的 PTR 记录的示例:

		444.333.222.111.in-addr.arpa.   33692   IN  PTR host.example.com.
		
Pv6 地址的这个 PTR 记录示例使用了 Google IPv6 DNS 服务器(2001:4860:4860::8888)的逆转形式的半字节格式.

		8.8.8.8.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.6.8.4.0.6.8.4.1.0.0.2.ip6.arpa. 86400IN PTR google-public-dns-a.google.com.
		
dig 命令的 `-x` 参数可用于查找 `IP 地址的反向 DNS 名称`.

下面是一个 dig 命令的例子.+short 确保只输出反向 DNS 名称.

		dig -x 8.8.4.4 +short
		
上述 dig 命令的输出将是该 IP 地址的 PTR 记录中的域名:

		google-public-dns-b.google.com.
		
互联网上的服务器在日志中使用 PTR 记录,来做出明智的垃圾邮件处理决策,并显示其他设备上的易于阅读的详细信息.

最常用的电子邮件服务器将查找从其接收电子邮件的 IP 地址的 PTR 记录.如果源 IP 地址没有与其相关联的 PTR 记录,则发送的电子邮件可被视为垃圾邮件并被拒绝.PTR 中的 FQDN 与要发送的电子邮件的域名是否匹配并不重要,重要的是存在有效的 PTR 记录,具有对应的和匹配的前向 A 记录.

通常,互联网上的网络路由器会被赋予与其物理位置相对应的 PTR 记录.例如,你可能会在纽约市或芝加哥看到使用 "NYC" 或 "CHI". 这对于运行 traceroute 或者 MTR 来检查网络流量经过的路径很有用.

		注意: PTR 记录中的 FQDN 具有对应的和匹配的正向 A 记录是非常重要的.示例:		111.222.333.444 有一条指向 http://server.example.com 的 PTR 记录,那 http://		server.example.com需要具有一条指向 111.222.333.444 的 A 记录.
		
		