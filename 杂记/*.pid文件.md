# *.pid文件

---

录/var/run下面一般我们都会看到很多的`*.pid`文件.而且往往新安装的程序在运行后也会在/var/run目录下面产生自己的pid文件.

*  pid文件的内容: pid文件为文本文件,内容只有一行,记录了该进程的ID.
*  pid文件的作用: **防止进程启动多个副本**.只有获得pid文件(固定路径固定文件名)写入权限(F_WRLCK)的进程才能正常启动并把自身的PID写入该文件中.其它同一个程序的多余进程则自动退出.


		cat /var/run/docker.pid
		6882
		
**编程**		
		
调用fcntl设置pid文件的锁定F_SETLK状态,其中锁定的标志位F_WRLCK.
如果成功锁定,则写入进程当前PID,进程继续往下执行.
如果锁定不成功,说明已经有同样的进程在运行了,当前进程结束退出.

**一些事项**

* 如果进程退出,则该进程加的锁自动失效.
* 如果进程关闭了该文件描述符fd,则加的锁失效.(整个进程运行期间不能关闭此文件描述符)
* 锁的状态不会被子进程继承.如果进程关闭则锁失效而不管子进程是否在运行.