# 23 非礼勿视

### 笔记

---

#### 目标: 写更少的代码

#### 反模式: 无米之炊

* 忽略数据库`API`的返回值.
* 和程序代码混在一起阅读那些分散的`SQL`语句片段.

会错过那些对修复错误非常有帮助的信息.

##### 没有诊断的诊断

如果可能出错的地方就需要捕获, 这样就不会在最后出现错误(比如查不到数据)但是不知道错误发生在什么地方.

##### 字里行间

与其盯着创建`SQL`查询字符串的代码调试, 比如直接输出`SQL`调试.

#### 如何识别反模式

* 我的程序在我执行查询之后就崩溃了.
* 你能帮我找一下我的`SQL`查询中的错误码? 这是我的代码...
* 我不会让错误处理弄乱了我的代码结构(至少50%的代码是用来进行错误处理的).

#### 合理使用反模式

不需要为错误负责的时候, 可以忽略错误处理. 比如 `close()`函数刽关闭一个到数据库的链接, 然后返回一个状态. 如果你的程序已经运行完成并准备退出了, 那所有的链接资源无论如何都会清空的, 也就不需要关心`close()`的返回值了.

#### 解决方案: 优雅地从错误中恢复

##### 保持节奏

检查数据库`API`调用的返回状态和异常.

##### 回溯你的脚步

* 使用一个变量来记录生成的`SQL`查询语句, 而不是在调用`API`方法, 传递参数的时候临时生成. 这样可以在使用生成的`SQL`语句之前对其进行检查.
* 选择一个不是程序输出的地方输出`SQL`语句.
	* 日志文件
	* IDE调试控制窗口
	* 显示调试输出的浏览器扩展
* 不要讲`SQL`语句当做`HTML`注释一起输出在页面中.

### 整理知识点

---