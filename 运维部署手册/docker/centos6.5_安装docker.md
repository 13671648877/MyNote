# CentOS6.5 安装docker

---

#### 升级内核

**升级3.10内核**

yum安装带aufs模块的3.10内核

		cd /etc/yum.repos.d 
		wget http://www.hop5.in/yum/el6/hop5.repo
		yum install kernel-ml-aufs kernel-ml-aufs-devel

**修改`grub`的主配置文件**		
				
修改grub的主配置文件/etc/grub.conf,设置default=0,表示第一个title下的内容为默认启动的kernel(一般新安装的内核在第一个位置)

		测试服务器阿里云:
		
		cat /etc/grub.conf
		
		# grub.conf generated by anaconda
		#
		# Note that you do not have to rerun grub after making changes to this file
		# NOTICE:  You do not have a /boot partition.  This means that
		#          all kernel and initrd paths are relative to /, eg.
		#          root (hd0,0)
		#          kernel /boot/vmlinuz-version ro root=/dev/xvda1
		#          initrd /boot/initrd-[generic-]version.img
		#boot=/dev/xvda
		default=0 
		timeout=5
		splashimage=(hd0,0)/boot/grub/splash.xpm.gz
		hiddenmenu
		title CentOS (3.10.5-3.el6.x86_64)
			root (hd0,0)
			kernel /boot/vmlinuz-3.10.5-3.el6.x86_64 ro root=UUID=94e4e384-0ace-437f-bc96-057dd64f42ee rd_NO_LUKS rd_NO_LVM LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=auto  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet
			initrd /boot/initramfs-3.10.5-3.el6.x86_64.img
		title CentOS (2.6.32-431.23.3.el6.x86_64)
			root (hd0,0)
			kernel /boot/vmlinuz-2.6.32-431.23.3.el6.x86_64 ro root=UUID=94e4e384-0ace-437f-bc96-057dd64f42ee rd_NO_LUKS rd_NO_LVM LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=auto  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet
			initrd /boot/initramfs-2.6.32-431.23.3.el6.x86_64.img
			
**重启系统**

重启系统(reboot)

		uname -r
		3.10.5-3.el6.x86_64
		
查看内核是否支持aufs:

		grep aufs /proc/filesystems
		nodev	aufs
		
#### 安装docker

**关闭selinux**

取消selinux,因为它会干扰lxc的正常功能

		sudo vim /etc/selinux/config 
		SELINUX=disabled
		SELINUXTYPE=targeted
		
**Fedora EPEL**

在Fedora EPEL源中已经提供了docker-io包,启用EPEL软件库

		sudo yum install http://ftp.riken.jp/Linux/fedora/epel/6/x86_64/epel-release-6-8.noarch.rpm
		
**yum安装docker-io**

		sudo yum install docker-io
		
**启动docker**

		service docker start
		Starting cgconfig service:                                 [  OK  ]
		dockerdoStarting docker:	                                [  OK  ]
		
**查看docker版本**

		docker version
		Client version: 1.7.1
		Client API version: 1.19
		Go version (client): go1.4.2
		Git commit (client): 786b29d/1.7.1
		OS/Arch (client): linux/amd64
		Server version: 1.7.1
		Server API version: 1.19
		Go version (server): go1.4.2
		Git commit (server): 786b29d/1.7.1
		OS/Arch (server): linux/amd64
		
#### 让非root用户使用docker命令(免 sudo 使用 docker)

**添加docker组**

如果还没有`docker group`就添加一个:

		sudo groupadd docker
		
**添加用到到docker组**
		
将用户加入该`group`内

		sudo gpasswd -a chloroplast docker
		将chloroplast添加到docker组
		
		id chloroplast
		uid=500(chloroplast) gid=500(chloroplast) 组=500(chloroplast),501(docker)
		
**重启docker服务**

		sudo service docker restart
		
**重启回话**

		否则因为 groups 命令获取到的是缓存的组信息,刚添加的组信息未能生效,所以docker images 执行时同样有错
		
**用户添加到docker组`危险`**

`docker`组内用户执行命令的时候会自动在所有命令前添加`sudo`.

		





