# 27_01_ftp服务

---

### 笔记

---

#### Name Resolve 名称解析

* Username --> UID: /etc/passwd
* Groupname --> GID
* Service Name --> PORT: /etc/services, 也可以存放到数据库中
* Hostname --> IP: DNS, /etc/hosts

只要有一种数据存储格式: 都可以称为解析库. 放在不同的库中所依赖的程序不一样.

不同的解析库需要不同的查询方式.

**nsswitch**

通用平台, 每个程序自己不在负责名称解析, 将功能委托给`nsswitch`.

`nsswitch` 本身是一个框架, 背后有不同的模块解析库来解析.

#### FTP

`F`ile `T`ransfer `P`rotocol.

`21/tcp`

在各主机实现文件共享服务.工作在`应用层`的协议. 在`tcp`上层.

`FTP`是文本协议.

文件传输协议.

基于`tcp`协议来实现.

有两个链接(HTTP协议之需要一个链接):

* 控制(命令)链接: 客户端请求,服务端发起响应.并不真正实现数据传输.`tcp 21`端口.命令链接一直在线.
* 数据链接: 服务端新打开一个链接向客户端传输数据.
	* FTP主动模式: 客户端请求下载数据, 服务器在`20`号端口,==主动==链接客户端.
	* FTP被动模式: 客户端请求传输数据时, 服务端通过`命令`链接发一个报文给客户端(我现在打开了一个端口,不是`20`端口(发送两个数字比如:151|20,则端口为 151x256 + 20),你来链接吧), 客户端主动链接服务端.==服务器端口不确定,端口随机==. 

数据链接只有当客户端发起下载请求的时候,文件传输完成以后断开.==按需打开,按需关闭==.

`C/S`模式, 有专用客户端.

**链接追踪**

`FTP`被动模式中, 端口是随机的, 服务器的防火墙怎么处理?

防火墙链接追踪功能: 防火墙进程可以判断链接和链接的关系,区分:

* 新请求的(新建立的链接请求状态,TCP第一次握手,`new`状态)
* 服务器请求,客户端响应的(建立链接的响应`establish`)

根据用户的链接请求, 来追踪来回请求的特征. 这种功能就是==链接追踪==. 能够识别请求相应链接本身彼此间的关系.

**为什么使用`FTP`被动模式**

因为如果服务端主动发起像客户端的请求链接,因为首先端口号是随机的(客户端命令链接的端口号+1), 其次客户端是有防火墙, 所以端口是屏蔽的(客户端一般不作为服务器响应,所以屏蔽了端口).

最终采用了 上面的`FTP`被动模式.

#### RPC

`R`emote `P`rocedure `C`all 

远程过程调用.

能够让位于不同主机的两个进程,能够基于二进制的格式实现数据通信.

`NFS`: 依赖于`RPC`工作的机制.

RPC跨越了传输层和应用层.

`Samba`: CIFS/SMB 实现跨平台文件共享.`Windows`的网络邻居就是`CIFS`协议.可以实现`Linux`和`Windows`文件共享.

#### 请求和响应

客户端, 发起请求, 不开放响应.

服务端负责响应.

### 整理知识点

---