# vmstat

---

## 简介

可以展现给定时间间隔的服务器的状态值, 包括服务器的CPU使用率, 内存使用, 虚拟内存交换情况, IO读写情况

## 参数

* 第一个参数: 采样的时间间隔数, 单位是秒.
* 第二个参数: 采样的次数.

## 使用

```
采样间隔 2 次, 一共采样 5 次.

[ansible@localhost ~]$ vmstat  2 5
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 1  0     56  76884    388 1607440    0    0     2    13    7    7  0  0 100  0  0
 0  0     56  76728    388 1607488    0    0     0     0  162  182  0  0 100  0  0
 0  0     56  76824    388 1607540    0    0     0     0  185  209  0  0 100  0  0
 0  0     56  76792    388 1607588    0    0     0     0  174  186  0  0 100  0  0
 0  0     56  76604    388 1607636    0    0     0  1024  142  151  0  0 100  0  0
```

### 输出结果

* `r`: 等待运行的进程数. 如果等待运行的进程数越多, 意味着CPU非常繁忙. 另外, 如果该参数长期大于和等于逻辑cpu个数，则CPU资源可能存在较大的瓶颈.
* `b`: 处在非中断睡眠状态的进程数. 意味着进程被阻塞. 主要是指被资源阻塞的进程对列数(比如IO资源, 页面调度等).
* `swpd`: 已使用的虚拟内存大小.如果虚拟内存使用较多, 可能系统的物理内存比较吃紧, 需要采取合适的方式来减少物理内存的使用. swapd不为0, 并不意味物理内存吃紧, 如果swapd没变化, `si、so`的值长期为0, 这也是没有问题的.
* `free`: 表示空闲的物理内存大小.
* `buff`: 用来做`buffer`(缓存,主要用于块设备缓存)的内存数, 单位: KB.
* `cache`: 用来做`cache`.(缓存,主要用于缓存文件)的内存, 单位: KB.
* `Swap`:
	* `si`: 每秒从磁盘读入虚拟内存的大小, 如果这个值大于0, 表示物理内存不够用或者内存泄露了.
	* `so`: 每秒虚拟内存写入磁盘的大小, 如果这个值大于0, 同上.
* `IO`:
	* `bi`: 块设备每秒接收的块数量, 这里的块设备是指系统上所有的磁盘和其他块设备, 默认块大小是1024byte.
	* `bo`: 块设备每秒发送的块数量, 例如我们读取文件, bo就要大于0. bi和bo一般都要接近0, 不然就是IO过于频繁, 需要调整.
* `System`:
	* `in`: 每秒CPU的中断次数, 包括时间中断.
	* `cs`: 每秒上下文切换次数, 例如我们调用系统函数, 就要进行上下文切换, 线程的切换, 也要进程上下文切换, 这个值越小越好, 太大了, 要考虑调低线程或者进程的数目, 例如在apache和nginx这种web服务器中, 我们一般做性能测试会进行几千并发甚至几万并发的测试, 选择web服务的进程可以由进程或者线程的峰值一直下调, 压测, 直到cs到一个比较小的值, 这个进程和线程数就是比较合适的值了. 系统调用也是, 每次调用系统函数, 我们的代码就会进入内核空间, 导致上下文切换, 这个是很耗资源, 也要尽量避免频繁调用系统函数. 上下文切换次数过多表示你的**CPU大部分浪费在上下文切换, 导致CPU干正经事的时间少了, CPU没有充分利用, 是不可取的.
* `CPU`: 
	* `us`: 用户CPU时间.
	* `sy`: 系统CPU时间.
	* `id`: 空闲CPU时间, 一般来说, id + us + sy = 100
	* `wt`: 等待IO CPU时间.