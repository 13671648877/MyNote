# iostat

---

## 简介

`iostat`查看系统`IO`状态信息, 从而确定`IO`性能是否存在瓶颈.

## 安装

```
sudo yum install -y sysstat
```

## 使用

```
iostat [options] [<interval> [ <count> ] ]
```

* options: 操作项
* interval: 统计时间间隔
* count: 总共输出次数

### 参数

#### -c

获取`cpu`部分状态值.

```
iostat -c
Linux 3.10.0-514.el7.x86_64 (mysql-1) 	03/08/2018 	_x86_64_	(2 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.08    0.00    0.14    0.01    0.00   99.76
```

#### -d

显示设备(磁盘)使用状态.

```
iostat -d
Linux 3.10.0-514.el7.x86_64 (mysql-1) 	03/08/2018 	_x86_64_	(2 CPU)

Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
sda               0.10         0.31         0.31     349368     352827
sdb               0.10         0.08         0.64      90977     718863
dm-0              0.07         0.30         0.29     336317     332831
dm-1              0.00         0.00         0.00       1520          0
dm-2              0.08         0.04         0.63      46303     710347
dm-3              0.00         0.00         0.00        504        264
dm-4              0.00         0.04         0.01      42646       8252
dm-5              0.00         0.04         0.01      42646       8252
dm-6              0.00         0.03         0.00      35325       5047
```

`sda`,`sdb`以及`sdb`各个分区的统计数据.

* `tps`: 该设备每秒的传输次数(Indicate the number of transfers per second that were issued to the device). **一次传输**意思是**一次I/O请求**. 多个逻辑请求可能会被合并为**一次I/O请求**. 一次传输请求的**大小**是未知的.

* `kB_read/s`: 每秒从设备(drive expressed)读取的数据量.
* `kB_wrtn/s`: 每秒向设备(drive expressed)写入的数据量.
* `kB_read`: 读取的总数据量.
* `kB_wrtn`: 写入的总数据量.

单位都是`Kilobytes`.

#### -x

输出更多详细信息.

```
iostat -x
Linux 3.10.0-514.el7.x86_64 (mysql-1) 	03/08/2018 	_x86_64_	(2 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.08    0.00    0.14    0.01    0.00   99.76

Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
sda               0.00     0.00    0.01    0.09     0.31     0.31    12.17     0.00   40.80   44.00   40.48  31.18   0.32
sdb               0.00     0.00    0.00    0.10     0.08     0.64    14.07     0.00   16.90   27.01   16.69  16.28   0.17
dm-0              0.00     0.00    0.01    0.06     0.30     0.29    16.81     0.00   61.14   55.17   61.81  45.05   0.32
dm-1              0.00     0.00    0.00    0.00     0.00     0.00    16.26     0.00   25.74   25.74    0.00  25.26   0.00
dm-2              0.00     0.00    0.00    0.07     0.04     0.63    17.70     0.00   22.30   29.40   22.23  21.50   0.16
dm-3              0.00     0.00    0.00    0.00     0.00     0.00     7.36     0.00   34.81   41.01   25.80  21.59   0.00
dm-4              0.00     0.00    0.00    0.00     0.04     0.01    71.12     0.00   27.94   26.55   33.00  19.00   0.00
dm-5              0.00     0.00    0.00    0.00     0.04     0.01    71.21     0.00   27.97   26.60   33.01  19.03   0.00
dm-6              0.00     0.00    0.00    0.00     0.03     0.00    89.94     0.00   30.40   26.46   41.40  20.66   0.00
```

* `rrqm/s`(读请求合并): 每秒这个设备相关的读取请求有多少`Merge`了(当系统调用需要读取数据的时候, VFS将请求发到各个FS, 如果FS发现不同的读取请求读取的是相同`Block`的数据, FS会将这个请求合并`Merge`);
* `wrqm/s`(写请求合并): 每秒这个设备相关的写入请求有多少被`Merge`了.

* `resc/s`: 每秒读取的扇区数.
* `wesc/s`: 每秒写入的扇区数.

* `r/s`: 每秒读操作的次数.
* `w/s`: 每秒写操作的次数.

* `rkB/s`: 每秒从设备读入的数据量,单位为K.
* `wkB/s`: 每秒向设备写入的数据量,单位为K.
 
* `avgrq-sz`: 平均请求扇区的大小.
* `avgqu-sz`: 平均请求队列的长度. 队列长度越短越好.

* `await`: I/O请求平均执行时间.包括发送请求和执行的时间.单位是毫秒.
	* `r_wait`: 每个读操作平均所需要的时间, 不仅包括硬盘设备**读**操作的时间, 也包括在内核队列中的时间.
	* `w_wait`: 每个写操作平均所需要的时间, 不仅包括硬盘设备**写**操作的时间, 也包括在队列中等待的时间.

* `svctm`: 表示平均每次设备`I/O`操作的服务时间(以毫秒为单位). 如果`svctm`的值与`await`(请求与执行)很接近, 表示几乎没有`I/O`等待, 磁盘性能很好, 如果`await`的值远高于`svctm`的值, 则表示`I/O`队列等待太长, 系统上运行的应用程序将变慢.

* `%util`: 在统计时间内所有处理IO时间, 除以总共统计时间. 例如, 如果统计间隔1秒, 该设备有0.8秒在处理IO, 而0.2秒闲置, 那么该设备的%util = 0.8/1 = 80%, 所以该参数暗示了设备的繁忙程度. 一般地, 如果该参数是100%表示设备已经接近满负荷运行了(当然如果是多磁盘,即使%util是100%,因为磁盘的并发能力,所以磁盘使用未必就到了瓶颈).




